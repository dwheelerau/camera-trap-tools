# camera-trap-tools  
Camera trap processing tools for researchers at DPIE, parks, and DPI.

## Running an automation pipeline based on MS Megadetector  
The goal of this pipeline is to automate the classification of camera trap image data into false and true triggers.  

1. Run the megadetector batch script from the git repo.  

The megadetector repo describes installation. The basic structure of the batch command is as follows.  

```
python detection/run_tf_detector_batch.py md_v4.1.0.pb IMAGE_DIR/ OUTPUT.json --checkpoint_frequency 100 --recursive
```

The above command uses the current MD weights file (md_v4.1.0.pb) to classify images located in `IMAGE_DIR` (replace this with the directory containing the images). The results will be saved to a JSON file called `OUTPUT.json` but it can be called anything. The `--checkpoint_frequency 100` switch is important as it saves the progress to file every n images (100 in this case), rather than keeping the entire results in memory. The `--recursive` flag will tell the program to step through nested directories and process those images as well.  

## Scripts  

### json_to_csv.py  
This script takes a JSON file generated by the MS megadetector batch run script and converts into a CSV file.  A key variable in the script is on line 12 `DET_THRESHOLD=0.8`. This should be changed if you want to categorise a different detection probability threshold. Irrespective of this setting the script will report MD detection thresholds for all objects, however objects below this threshold are ignored when reporting other info, such as the number and types of object found in the image.   

`usage: python json_to_csv.py <INFILE.json>`  

The resulting CSV file will have the same filename as the infile.json but will end in `.CSV`. Note the infile must end in `.json` or the script will complain.  
 
The header on the CSV file are:  
- `filename`: filename of target image that was processed  
- `max_confidence`: MD reported max confidence of an animal in the image  
- `#obj`: The number of animal objects detected by MD  
- `obj_categories`: Animal=1, Human=2, car=3.  
